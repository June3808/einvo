(function(n){function i(n){return typeof n=="undefined"?!1:!0}function nt(n){return!i(n)||typeof n=="object"}function g(t,r){var c,f,l,a,u,e,s;if(i(r.customValues))for(key in r.customValues)if(t==r.customValues[key])return key;if(c=/^0\s(0\/1|\d{1,2})\s(0\/1|\d{1,2}|\*)\s(\d{1,2}|\*|\?)\s(\d{1,2}|\*)\s(\d{1,2}|\?)(\s\*)?$/,typeof t!="string"||!c.test(t))return n.error("cron: invalid initial value"),undefined;for(f=t.split(" "),f=f.splice(1,f.length-1),l=[0,0,1,1,1],a=[59,23,31,12,7],u=0;u<f.length;u++)if(f[u]!="*"&&!/^0\/1$/.test(f[u])&&f[u]!="?"&&(e=parseInt(f[u]),!i(e)||!(e<=a[u])||!(e>=l[u])))return n.error("cron: invalid value found (col "+(u+1)+") in "+o.initial),undefined;for(s in h)if(h[s].test(t))return s;return n.error("cron: valid but unsupported cron format. sorry."),undefined}function tt(t,r){if(!i(g(r.initial,r))||!nt(r.customValues))return!0;if(i(r.customValues))for(key in r.customValues)if(h.hasOwnProperty(key))return n.error("cron: reserved keyword '"+key+"' should not be used as customValues key."),!0;return!1}function it(n){var t=n.data("block"),i=hour=day=month=dow="*",r=t.period.find("select").val();switch(r){case"minute":return"0 0/1 * * * ?";case"hour":return i=t.mins.find("select").val(),["0",i,"0/1","*","*","?"].join(" ");case"day":return i=t.time.find("select.cron-time-min").val(),hour=t.time.find("select.cron-time-hour").val(),["0",i,hour,"*","*","?"].join(" ");case"week":return i=t.time.find("select.cron-time-min").val(),hour=t.time.find("select.cron-time-hour").val(),dow=t.dow.find("select").val(),["0",i,hour,"?","*",dow].join(" ");case"month":return i=t.time.find("select.cron-time-min").val(),hour=t.time.find("select.cron-time-hour").val(),day=t.dom.find("select").val(),["0",i,hour,day,"*","?"].join(" ");case"year":return i=t.time.find("select.cron-time-min").val(),hour=t.time.find("select.cron-time-hour").val(),day=t.dom.find("select").val(),month=t.month.find("select").val(),["0",i,hour,day,month,"?","*"].join(" ");default:return r}}for(var a,f,v,d,y,p,w,b,k,e,s,h,u,c,r={initial:"0 0/1 * * * ?",minuteOpts:{minWidth:100,itemWidth:30,columns:4,rows:undefined,title:"Minutes Past the Hour"},timeHourOpts:{minWidth:100,itemWidth:20,columns:2,rows:undefined,title:"Time: Hour"},domOpts:{minWidth:100,itemWidth:30,columns:undefined,rows:10,title:"Day of Month"},monthOpts:{minWidth:100,itemWidth:100,columns:2,rows:undefined,title:undefined},dowOpts:{minWidth:100,itemWidth:undefined,columns:undefined,rows:undefined,title:undefined},timeMinuteOpts:{minWidth:100,itemWidth:20,columns:4,rows:undefined,title:"Time: Minute"},effectOpts:{openSpeed:400,closeSpeed:400,openEffect:"slide",closeEffect:"slide",hideOnMouseOut:!0},url_set:undefined,customValues:undefined,onChange:undefined,useGentleSelect:!1},l="",t=0;t<60;t++)f=t<10?"0":"",l+="<option value='"+t+"'>"+f+t+"<\/option>\n";for(a="",t=0;t<24;t++)f=t<10?"0":"",a+="<option value='"+t+"'>"+f+t+"<\/option>\n";for(v="",t=1;t<32;t++)d=t==1||t==21||t==31?"st":t==2||t==22?"nd":t==3||t==23?"rd":"th",v+="<option value='"+t+"'>"+t+d+"<\/option>\n";for(y="",p=["January","February","March","April","May","June","July","August","September","October","November","December"],t=0;t<p.length;t++)y+="<option value='"+(t+1)+"'>"+p[t]+"<\/option>\n";for(w="",b=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],t=0;t<b.length;t++)w+="<option value='"+(t+1)+"'>"+b[t]+"<\/option>\n";for(k="",e=["minute","hour","day","week","month","year"],t=0;t<e.length;t++)k+="<option value='"+e[t]+"'>"+e[t]+"<\/option>\n";s={minute:[],hour:["mins"],day:["time"],week:["dow","time"],month:["dom","time"],year:["dom","month","time"]};h={minute:/^0\s(0\/1)\s(\*\s){3}\?$/,hour:/^0\s\d{1,2}\s(0\/1)\s(\*\s){2}\?$/,day:/^0\s(\d{1,2}\s){2}(\*\s){2}\?$/,week:/^0\s(\d{1,2}\s){2}\?\s(\*\s)\d{1,2}$/,month:/^0\s(\d{1,2}\s){3}\*\s\?$/,year:/^0\s(\d{1,2}\s){4}\?\s\*$/};u={init:function(t){var s=t?t:{},f=n.extend([],r,s),h=n.extend({},r.effectOpts,s.effectOpts),b,o;if(n.extend(f,{minuteOpts:n.extend({},r.minuteOpts,h,s.minuteOpts),domOpts:n.extend({},r.domOpts,h,s.domOpts),monthOpts:n.extend({},r.monthOpts,h,s.monthOpts),dowOpts:n.extend({},r.dowOpts,h,s.dowOpts),timeHourOpts:n.extend({},r.timeHourOpts,h,s.timeHourOpts),timeMinuteOpts:n.extend({},r.timeMinuteOpts,h,s.timeMinuteOpts)}),tt(this,f))return this;var e=[],d="",p=f.customValues;if(i(p))for(b in p)d+="<option value='"+p[b]+"'>"+b+"<\/option>\n";return e.period=n("<span class='cron-period'>Every <select name='cron-period'>"+d+k+"<\/select> <\/span>").appendTo(this).data("root",this),o=e.period.find("select"),o.bind("change.cron",c.periodChanged).data("root",this),f.useGentleSelect&&o.gentleSelect(h),e.dom=n("<span class='cron-block cron-block-dom'><span> on the<\/span> <select name='cron-dom'>"+v+"<\/select> <\/span>").appendTo(this).data("root",this),o=e.dom.find("select").data("root",this),f.useGentleSelect&&o.gentleSelect(f.domOpts),e.month=n("<span class='cron-block cron-block-month'><span> of<\/span> <select name='cron-month'>"+y+"<\/select> <\/span>").appendTo(this).data("root",this),o=e.month.find("select").data("root",this),f.useGentleSelect&&o.gentleSelect(f.monthOpts),e.mins=n("<span class='cron-block cron-block-mins'><span> at<\/span> <select name='cron-mins'>"+l+"<\/select> minutes past the hour <\/span>").appendTo(this).data("root",this),o=e.mins.find("select").data("root",this),f.useGentleSelect&&o.gentleSelect(f.minuteOpts),e.dow=n("<span class='cron-block cron-block-dow'><span> on<\/span> <select name='cron-dow'>"+w+"<\/select> <\/span>").appendTo(this).data("root",this),o=e.dow.find("select").data("root",this),f.useGentleSelect&&o.gentleSelect(f.dowOpts),e.time=n("<span class='cron-block cron-block-time'><span> at<\/span> <select name='cron-time-hour' class='cron-time-hour'>"+a+"<\/select>:<select name='cron-time-min' class='cron-time-min'>"+l+" <\/span>").appendTo(this).data("root",this),o=e.time.find("select.cron-time-hour").data("root",this),f.useGentleSelect&&o.gentleSelect(f.timeHourOpts),o=e.time.find("select.cron-time-min").data("root",this),f.useGentleSelect&&o.gentleSelect(f.timeMinuteOpts),e.controls=n("<span class='cron-controls'>&laquo; save <span class='cron-button cron-button-save'><\/span> <\/span>").appendTo(this).data("root",this).find("span.cron-button-save").bind("click.cron",c.saveClicked).data("root",this).end(),this.find("select").bind("change.cron-callback",c.somethingChanged),this.data("options",f).data("block",e),this.data("current_value",f.initial),u.value.call(this,f.initial)},value:function(n){var t,l,a,r,f,e,v;if(!n)return it(this);var o=this.data("options"),h=this.data("block"),c=o.useGentleSelect,u=g(n,o);if(!i(u))return!1;if(i(o.customValues)&&o.customValues.hasOwnProperty(u))u=o.customValues[u];else{for(t=n.split(" "),t=t.splice(1,t.length-1),r=0;r<t.length;r++)/^0\/1$/.test(t[r])&&(t[r]=undefined),t[r]==="?"&&(t[r]=undefined);for(l={mins:t[0],hour:t[1],dom:t[2],month:t[3],dow:t[4]},a=s[u],r=0;r<a.length;r++)f=a[r],f=="time"?(e=h[f].find("select.cron-time-hour").val(l.hour),c&&e.gentleSelect("update"),e=h[f].find("select.cron-time-min").val(l.mins),c&&e.gentleSelect("update")):(e=h[f].find("select").val(l[f]),c&&e.gentleSelect("update"))}return v=h.period.find("select").val(u),c&&v.gentleSelect("update"),v.trigger("change"),this}};c={periodChanged:function(){var i=n(this).data("root"),u=i.data("block"),e=i.data("options"),f=n(this).val(),r,t;if(i.find("span.cron-block").hide(),s.hasOwnProperty(f))for(r=s[n(this).val()],t=0;t<r.length;t++)u[r[t]].show()},somethingChanged:function(){root=n(this).data("root");i(root.data("options").url_set)?u.value.call(root)!=root.data("current_value")?(root.addClass("cron-changed"),root.data("block").controls.fadeIn()):(root.removeClass("cron-changed"),root.data("block").controls.fadeOut()):root.data("block").controls.hide();var t=root.data("options").onChange;i(t)&&n.isFunction(t)&&t.call(root)},saveClicked:function(){var i=n(this),t=i.data("root"),r=u.value.call(t);i.hasClass("cron-loading")||(i.addClass("cron-loading"),n.ajax({type:"POST",url:t.data("options").url_set,data:{cron:r},success:function(){t.data("current_value",r);i.removeClass("cron-loading");r==u.value.call(t)&&(t.removeClass("cron-changed"),t.data("block").controls.fadeOut())},error:function(){alert("An error occured when submitting your request. Try again?");i.removeClass("cron-loading")}}))}};n.fn.cron=function(t){if(u[t])return u[t].apply(this,Array.prototype.slice.call(arguments,1));if(typeof t!="object"&&t)n.error("Method "+t+" does not exist on jQuery.cron");else return u.init.apply(this,arguments)}})(jQuery);